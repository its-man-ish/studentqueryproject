#!/usr/bin/env node

'use strict';

const fs = require( 'fs' );
const { resolve: resolvePath } = require( 'path' );

const packagePath = resolvePath( __dirname, './../../' );
const pluginPath = resolvePath( packagePath, './spreadsheet' );
const CKEPath = resolvePath( packagePath, './../..' );

const packageInfo = require( resolvePath( packagePath, 'package.json' ) );
const pluginName = packageInfo.name.replace( 'ckeditor4-plugin-', '' );

if ( !fs.existsSync( resolvePath( CKEPath, 'ckeditor.js' ) ) ) {
	process.exit( 0 );
}

fs.symlinkSync( pluginPath, resolvePath( CKEPath, `plugins/${ pluginName }` ), 'dir' );

// Update config.
fs.appendFileSync( resolvePath( CKEPath, 'config.js' ), `;CKEDITOR.editorConfig = function( config ) {
	config.plugins += ',${ pluginName }';
}`, 'utf8' );

process.exit( 0 );
